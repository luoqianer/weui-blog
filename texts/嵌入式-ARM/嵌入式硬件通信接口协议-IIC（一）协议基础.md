---
layout: blog
title: 嵌入式硬件通信接口协议-IIC（一）协议基础
date: 2019-03-05 17:19:25
categories: 嵌入式-ARM
tags: [IIC,单片机外设]
---
本节继续讲嵌入式硬件通信接口协议中的又一个串行通信接口-IIC。相比于UART串口协议和SPI串行外设接口协议，这个IIC又有其独特之处。

简介
====

IIC（**Inter-Integrated Circuit**），集成电路总线。

*IIC 即Inter-Integrated
Circuit(集成电路总线），这种总线类型是由*[飞利浦](https://baike.baidu.com/item/%E9%A3%9E%E5%88%A9%E6%B5%A6)*半导体公司在八十年代初设计出来的一种简单、双向、二线制、同步串行总线，主要是用来连接整体电路(*[ICS](https://baike.baidu.com/item/ICS)*)
，IIC是一种多向*[控制总线](https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E6%80%BB%E7%BA%BF/272568)*，也就是说多个芯片可以连接到同一*[总线结构](https://baike.baidu.com/item/%E6%80%BB%E7%BA%BF%E7%BB%93%E6%9E%84/10183496)*下，同时每个芯片都可以作为实时数据传输的控制源。这种方式简化了信号传输总线接口。*

*--from 百度百科*

*https://baike.baidu.com/item/iic/3524834*

相比于SPI接口《[嵌入式硬件通信接口协议-SPI（一）协议基础](https://mp.weixin.qq.com/s/hDUK43s8naybJLvoE2UsoA)》，此处的IIC接口定义了多主多从的通信架构，在同一IIC总线上可有多个主机和多个从机。“主-\>从”的通信架构使得通信的主动权在主机端，主机发起一次通信，从机做出响应。

信号线
======

IIC作为两线串行总线，信号线分别是：

SCL（Serial Clock Line）：串行时钟，主机输出

SDA（Serial Data Line）：串行数据，双向传输

**总线信号的电平在电路连接上，一般加上拉电阻Rp，使得总线在空闲时，信号管脚处于高电平状态。**

这里可以具体到一些芯片的手册里，明确写出线路连接时的上拉电阻要求：

在SHT20温湿度传感器中的上拉电阻R-Pull要求

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/b753a96d08572d05d8ec2708aee1c1a9.png)

在触摸按键BS116A-3芯片数据手册中：

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/8a0832a6e5fa6b579378cebf57af6175.png)

信号时序
========

IIC作为同步串行总线，可以认为有两个同步信号，第一个是通信起始、结束标志，告知挂在IIC总线上的从机设备，何时开始通信并且何时结束；第二个是同步时钟信号SCL，收发双方进行数据的交互时，都是基于SCL的跳变进行逐bit输出和采样的。

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/b7838c09fb9ffae85987eab3566f7aa8.png)

1.  **起始标志**

>   处于空闲状态下时，SCL和SDA都是高电平，某一时刻，SDA拉低，则此刻认为开始IIC传输。

1.  **结束标志**

>   即将完成数据传输时，在SCL处于高电平时，将SDA强制拉高，则此刻认为结束IIC传输。

1.  **数据输出**

>   在SCL为低电平时，发送方根据传输的数据内容逐bit改变SDA的电平。

1.  **数据采样**

>   在SCL为高电平时，接收方读取SDA的电平逐bit接收，并逐8个bit组成1个Byte。

1.  **应答ACK**

>   ACK表示在8bit数据后的第9个时钟的高电平期间，SDA保持低电平。

1.  **应答NACK**

>   NACK表示在8bit数据后的第9个时钟的高电平期间，SDA保持高电平。

关于理解和记忆，推荐分组记忆：

1.  SCL高电平时，SDA拉低开始，SDA拉高结束

2.  SCL高电平时，接收方采样SDA管脚电平；SCL低电平时，发送方改变SDA管脚电平

3.  应答位，SDA低电平表示ACK，SDA高电平表示NACK。

以上就是IIC在通信过程中，可能出现的信号时序状态特征。

如果要和SPI接口对比，我们发现，在IIC总线上挂了多个从设备，某个时刻某个主机要与某个从设备通信时，却不像SPI那样有单独一个片选信号管脚SS。

那么IIC要实现主机与指定从机的通信，需要每次开始通信时，主机会先把指定从机设备的地址通过接口发出，这样一来，对应的从机设备即可被选中，才能进行后续的通信操作。

类似的，每个具有IIC接口的外围器件，其数据手册中都有关于地址的配置：

SHT20温湿度芯片地址配置

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/b35e0c291542824542562bd0c6b942c0.png)

BS116-3触摸芯片地址配置

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/99e9ee42854945d453bef68171671121.png)

AT24C1024B存储芯片

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/a405115252d0496ccbeaecd6cd1393a0.png)

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/c60a0409efa5b4adcb1e8e71de16c3a8.png)

我们发现，IIC设备的地址普遍是**7bit**，而发送一次数据都是一个字节**8bit**地发送，所以要发送地址时，都会带上读写位，组成一个字节后发出。

**读写位的意义，主要在于明确IIC从机设备，在被主机“点名”后，接下来是被主机读取还是被主机写入，靠的就是这个读写位来判断。**

*另外，类似于AT24C1024B存储芯片，在7bit的地址位里，又有3个bit的A2、A1、A0可以在硬件电路上选择不同的连接方式，从而又有8种不同的从机地址，也就是说同个IIC总线上可以挂同种型号的AT24C1024B存储芯片8片。*

接口配置项

相比于SPI接口丰富的配置项，然而IIC仅有2根数据线，可配置的也就是时钟SCL的翻转速率，因为这个时钟的速率直接影响到数据的传输速率。这里所配置的推荐值，应该确认IIC总线上各个从机设备的速率极限，这样在设计IIC接口时，能够兼容总线上的所有设备通信速率。

SHT20温湿度传感器

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/b6b9585b205ab7357716f618e6643b2a.png)

BS116-3触摸芯片时钟极限

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/1f37afce297b01f521dd2f6cd0f944eb.png)

AT24C1024B存储芯片的时钟要求

![](/img/blog_pic/【硬件电路】嵌入式硬件通信接口协议-IIC（一）协议基础/63a45336da50c85cba148b156ba88eda.png)

综上所述，IIC总线接口，属于两线、多主多从、半双工通信接口协议。熟悉两根信号线的时序图，基本上对IIC的了解就差不多了。

